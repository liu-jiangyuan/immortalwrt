name: Build ImmortalWrt MT7981 (BT R320)
#
#on:
#  push:
#    branches:
##      - openwrt-24.10
#  workflow_dispatch:
#
#jobs:
#  build:
#    runs-on: ubuntu-22.04
#
#    steps:
#      - name: Checkout
#        uses: actions/checkout@v4
#
#      - name: Fix script permissions
#        run: |
#          chmod -R +x .
#
#      - name: Set TERM
#        run: |
#          export TERM=xterm
#
#      # 关键：先腾磁盘
#      - name: Free disk space
#        run: |
#          sudo rm -rf /usr/share/dotnet
#          sudo rm -rf /opt/ghc
#          sudo rm -rf /opt/hostedtoolcache
#          sudo docker image prune -af
#          df -h
#
#      - name: Install build dependencies
#        run: |
#          sudo apt update
#          sudo apt install -y \
#            build-essential make gcc g++ \
#            clang llvm flex bison gawk \
#            git wget curl rsync unzip file time \
#            libncurses-dev libssl-dev zlib1g-dev \
#            python3 python3-dev \
#            python3-setuptools python3-socks python3-unidecode swig \
#            cmake ninja-build libelf-dev \
#            jq ccache \
#            libncurses5-dev gettext xsltproc \
#            bzip2 patch
#
#      # ⭐ 关键：强制清理，确保 SUPPORTED_DEVICES 生效
#      - name: Clean build tree
#        run: |
#          make target/linux/clean || true
#          make dirclean || true
#
#      # 只 cache dl（这是安全的）
#      - name: Cache dl
#        uses: actions/cache@v4
#        with:
#          path: dl
#          key: ${{ runner.os }}-immortalwrt-dl
#          restore-keys: |
#            ${{ runner.os }}-immortalwrt-
#
#      - name: Update feeds
#        run: |
#          ./scripts/feeds update -a
#          ./scripts/feeds install -a
#
#      - name: Load config
#        run: |
#          cp bt_r320.config .config
#          make defconfig
#
#      - name: Download packages
#        run: |
#          make download -j2
#
#      - name: Build firmware
#        run: |
#          make -j2 || make -j1 V=s
#
#      - name: Upload firmware
#        uses: actions/upload-artifact@v4
#        with:
#          name: firmware
#          path: bin/targets/
